<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <title>ğŸ–¨ï¸ Ù†Ø¸Ø§Ù… Ø¥Ø¯Ø§Ø±Ø© Ø§Ù„Ø·Ø¨Ø§Ø¹Ø© - Firebase</title>
    <!-- Firebase CDN -->
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore-compat.js"></script>
    <!-- Ø¨Ø§Ù‚ÙŠ Ø¥Ø¹Ø¯Ø§Ø¯Ø§ØªÙƒ ÙˆCSS ... -->
</head>
<body>
    <!-- ... ÙƒÙ„ ÙˆØ§Ø¬Ù‡ØªÙƒ ÙƒÙ…Ø§ Ù‡ÙŠ ... -->

    <div class="container">
        <!-- ... (Ù†ÙØ³ Ø§Ù„Ù‡ÙŠÙƒÙ„ÙŠØ© Ø§Ù„ØªÙŠ Ø£Ø±Ø³Ù„ØªÙ‡Ø§) ... -->
    </div>

<script>
/* ========== Ø¥Ø¹Ø¯Ø§Ø¯ Firebase ========== */
const firebaseConfig = {
  apiKey: "AIzaSyDvmIfR0Hv8VHO4EF2IQzCPWmofJzpgWCE",
  authDomain: "printing-system-test.firebaseapp.com",
  projectId: "printing-system-test",
  storageBucket: "printing-system-test.firebasestorage.app",
  messagingSenderId: "1044426463632",
  appId: "1:1044426463632:web:e441df884b1c96b79bfb15",
  measurementId: "G-KPTW5WDNS6"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

/* ========== Ù…ØªØºÙŠØ±Ø§Øª ========== */
let jobs = []; // Ø³Ù†Ø¬Ù„Ø¨Ù‡Ø§ Ù…Ù† Firestore
let unsubscribeJobs = null; // Ù„Ù„Ù…Ø²Ø§Ù…Ù†Ø© Ø§Ù„Ù„Ø­Ø¸ÙŠØ©

/* ========== Ø¬Ù„Ø¨ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ Ù…Ù† Firestore + Ù…Ø²Ø§Ù…Ù†Ø© Ù„Ø­Ø¸ÙŠØ© ========== */
function listenToJobs() {
    if (unsubscribeJobs) unsubscribeJobs(); // Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ø§Ø´ØªØ±Ø§Ùƒ Ø§Ù„Ø³Ø§Ø¨Ù‚
    unsubscribeJobs = db.collection("jobs")
        .orderBy("createdAt", "desc")
        .onSnapshot((snapshot) => {
            jobs = [];
            snapshot.forEach(doc => {
                jobs.push({ ...doc.data(), id: doc.id });
            });
            displayJobs();
            updateStats();
        });
}

/* ========== Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ Ø¬Ø¯ÙŠØ¯ Ø¥Ù„Ù‰ Firestore ========== */
async function addJob(event) {
    event.preventDefault();
    const name = document.getElementById('jobName').value.trim();
    const details = document.getElementById('jobDetails').value.trim();
    const printerName = document.getElementById('printerNameSelect').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    const totalQuantity = document.getElementById('totalQuantity').value.trim() || 'ØºÙŠØ± Ù…Ø­Ø¯Ø¯';
    const isUrgent = document.getElementById('isUrgent').checked;

    if (!name) {
        showMessage('âŒ ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„', 'error');
        return;
    }

    try {
        await db.collection("jobs").add({
            name,
            printerName,
            totalQuantity,
            details,
            isUrgent,
            status: 'pending',
            createdAt: new Date().toISOString()
        });
        showMessage('âœ… ØªÙ… Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
        clearForm();
        switchTab('jobs');
    } catch (err) {
        showMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø¥Ø¶Ø§ÙØ©', 'error');
        console.error(err);
    }
}

/* ========== Ø­Ø°Ù Ø¹Ù…Ù„ Ù…Ù† Firestore ========== */
async function deleteJob(jobId) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ØŸ')) return;
    try {
        await db.collection("jobs").doc(jobId).delete();
        showMessage('âœ… ØªÙ… Ø­Ø°Ù Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­', 'success');
    } catch (err) {
        showMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø­Ø°Ù', 'error');
        console.error(err);
    }
}

/* ========== Ø¥ÙƒÙ…Ø§Ù„ Ø¹Ù…Ù„ ========== */
async function completeJob(jobId) {
    if (!confirm('Ù‡Ù„ Ø£Ù†Øª Ù…ØªØ£ÙƒØ¯ Ù…Ù† Ø¥ÙƒÙ…Ø§Ù„ Ù‡Ø°Ø§ Ø§Ù„Ø¹Ù…Ù„ØŸ')) return;
    try {
        await db.collection("jobs").doc(jobId).update({
            status: "completed",
            completedAt: new Date().toISOString()
        });
        showMessage('âœ… ØªÙ… Ø¥ÙƒÙ…Ø§Ù„ Ø§Ù„Ø¹Ù…Ù„ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    } catch (err) {
        showMessage('âŒ Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ Ø§Ù„ØªØ­Ø¯ÙŠØ«', 'error');
        console.error(err);
    }
}

/* ========== Ø¹Ø±Ø¶ Ø§Ù„Ø£Ø¹Ù…Ø§Ù„ (Ù†ÙØ³ Ø¯Ø§Ù„ØªÙƒ Ù…Ø¹ ØªØ¹Ø¯ÙŠÙ„ Ø¨Ø³ÙŠØ·) ========== */
function displayJobs() {
    const container = document.getElementById('jobsList');
    if (!jobs.length) {
        container.innerHTML = `<div class="empty-state"><div class="empty-state-icon">ğŸ“­</div><h3>Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø¹Ù…Ø§Ù„</h3><p>Ø§Ø¨Ø¯Ø£ Ø¨Ø¥Ø¶Ø§ÙØ© Ø¹Ù…Ù„ Ø·Ø¨Ø§Ø¹Ø© Ø¬Ø¯ÙŠØ¯</p></div>`;
        return;
    }
    container.innerHTML = jobs.map(job => `
        <div class="job-card ${job.status} ${job.isUrgent ? 'urgent' : ''}">
            <div class="job-header">
                <div class="job-title">${job.name}</div>
                <div class="job-status">${getStatusText(job)}</div>
            </div>
            <div class="job-details">
                <div class="job-detail-row"><span class="job-detail-label">Ø§Ù„Ø·Ø¨Ø§Ø¹:</span><span class="job-detail-value">${job.printerName}</span></div>
                <div class="job-detail-row"><span class="job-detail-label">Ø§Ù„ÙƒÙ…ÙŠØ©:</span><span class="job-detail-value">${job.totalQuantity}</span></div>
                ${job.details ? `<div class="job-detail-row"><span class="job-detail-label">Ø§Ù„ØªÙØ§ØµÙŠÙ„:</span><span class="job-detail-value">${job.details}</span></div>` : ''}
                <div class="job-detail-row"><span class="job-detail-label">Ø§Ù„ØªØ§Ø±ÙŠØ®:</span><span class="job-detail-value">${new Date(job.createdAt).toLocaleDateString('ar-EG')}</span></div>
            </div>
            <div class="job-actions">
                <button class="btn btn-success" onclick="completeJob('${job.id}')">âœ… Ø¥ÙƒÙ…Ø§Ù„</button>
                <button class="btn btn-danger" onclick="deleteJob('${job.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
        </div>
    `).join('');
}

/* ========== ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª ========== */
function updateStats() {
    document.getElementById('totalJobs').textContent = jobs.length;
    document.getElementById('pendingJobs').textContent = jobs.filter(j => j.status === 'pending').length;
    document.getElementById('inProgressJobs').textContent = jobs.filter(j => j.status === 'in-progress').length;
    document.getElementById('completedJobs').textContent = jobs.filter(j => j.status === 'completed').length;
}

/* ========== Ø¯ÙˆØ§Ù„ Ø«Ø§Ø¨ØªØ© Ù…Ù† ÙƒÙˆØ¯Ùƒ (Ù…Ø«Ù„ switchTab, showMessage, clearForm, ... Ø¥Ù„Ø®) ========== */
/* Ø¶Ø¹ Ù†ÙØ³ Ø¯ÙˆØ§Ù„Ùƒ Ø§Ù„Ù‚Ø¯ÙŠÙ…Ø© Ù‡Ù†Ø§ØŒ Ø¨Ø§Ø³ØªØ«Ù†Ø§Ø¡ Ø¯ÙˆØ§Ù„ saveData ÙˆØ£ÙŠ ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ localStorage - Ø§Ø­Ø°ÙÙ‡Ø§! */

function showMessage(msg, type) {
    const el = document.getElementById('messages');
    el.innerHTML = `<div class="message ${type}">${msg}</div>`;
    setTimeout(() => { el.innerHTML = ""; }, 3000);
}
function clearForm() {
    document.getElementById('jobForm').reset();
}
function switchTab(tabName) {
    document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
    // ... Ø£ÙƒÙ…Ù„ ÙƒÙ…Ø§ Ù‡Ùˆ ÙÙŠ ÙƒÙˆØ¯Ùƒ
}
function getStatusText(job) {
    const statusMap = {
        'pending': 'ÙÙŠ Ø§Ù„Ø§Ù†ØªØ¸Ø§Ø±',
        'in-progress': 'Ù‚ÙŠØ¯ Ø§Ù„Ø·Ø¨Ø§Ø¹Ø©',
        'completed': 'Ù…ÙƒØªÙ…Ù„'
    };
    let statusText = statusMap[job.status] || job.status;
    if (job.isUrgent && job.status !== 'completed') statusText += ' âš¡';
    return statusText;
}

/* ========== Ø±Ø¨Ø· Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ========== */
document.addEventListener('DOMContentLoaded', function() {
    listenToJobs();
    document.getElementById('jobForm').addEventListener('submit', addJob);
    // ... Ø£Ø±Ø¨Ø· Ø¨Ø§Ù‚ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø« ÙƒÙ…Ø§ ÙƒØ§Ù† ÙÙŠ ÙƒÙˆØ¯Ùƒ
});
</script>
</body>
</html>
